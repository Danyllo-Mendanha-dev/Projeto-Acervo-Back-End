{% extends 'base.html' %} 

{% block title %}Gerenciar Funcionários | Biblioteca{% endblock %} 

{% block content %}
<div class="card shadow mb-4">
  <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
    <h6 class="m-0 font-weight-bold text-primary">
      <i class="fas fa-users-cog"></i> Gerenciamento de Funcionários
    </h6>
    <a href="{% url 'funcionarios:cadastrar_funcionario' %}" class="btn btn-primary btn-sm">
      <i class="fas fa-plus-circle"></i> Cadastrar Funcionário
    </a>
  </div>

  <div class="card-body">
    <p>
      Utilize esta página para gerenciar os Funcionários do sistema. Você pode
      consultar a lista, buscar por nome ou e-mail, e utilizar os botões de ação
      para editar ou excluir (desativar) um registro.
    </p>

    <div class="mb-4">
      <form method="GET" action="{% url 'funcionarios:funcionario_list' %}">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            name="q"
            placeholder="Buscar por nome ou e-mail..."
            value="{{ request.GET.q }}"
          />
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit">
              <i class="fas fa-search"></i> Buscar
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="thead-light">
          <tr>
            <th scope="col">Nome</th>
            <th scope="col">E-mail</th>
            <th scope="col">Telefone</th>
            <th scope="col" class="text-center">Status</th> <th scope="col" class="text-center">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for funcionario in funcionarios %}
          <tr class="{% if funcionario.status == 'Inativo' %}table-secondary text-muted{% endif %}">
            
            <td class="align-middle">{{ funcionario.nome }}</td>
            <td class="align-middle">{{ funcionario.email }}</td>
            <td class="align-middle">{{ funcionario.telefone|default:"Não informado" }}</td>
            
            <td class="text-center align-middle">
                {% if funcionario.status == 'Ativo' %}
                    <span class="badge badge-success">Ativo</span>
                {% else %}
                    <span class="badge badge-secondary">Inativo</span>
                {% endif %}
            </td>

            <td class="text-center align-middle">
              {% if funcionario.status == 'Inativo' %}
                  <a href="{% url 'funcionarios:reativar_funcionario' funcionario.pk %}" 
                     class="btn btn-success btn-sm" 
                     title="Reativar Acesso"
                     onclick="return confirm('Deseja reativar o acesso deste funcionário?');">
                      <i class="fas fa-check-circle"></i> Reativar
                  </a>
              {% else %}
                  <a href="{% url 'funcionarios:atualizar_funcionario' funcionario.pk %}" 
                     class="btn btn-info btn-sm" 
                     title="Editar">
                      <i class="fas fa-edit"></i>
                  </a>
                  
                  <a href="{% url 'funcionarios:excluir_funcionario' funcionario.pk %}" 
                     class="btn btn-danger btn-sm" 
                     title="Excluir / Desativar">
                      <i class="fas fa-trash-alt"></i>
                  </a>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted py-4">
                <i class="fas fa-user-slash fa-2x mb-3"></i>
                <p>Nenhum funcionário encontrado.</p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}